<template>
  <div class="h-full bg-login relative">
    <svg width="1072" height="1079" viewBox="0 0 1072 1079" fill="none" xmlns="http://www.w3.org/2000/svg">
      <g opacity="0.5">
        <mask id="mask0_114_46407" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="-30" y="0" width="1102"
          height="1080">
          <path d="M1072 0H-30V1080H1072V0Z" fill="white" />
        </mask>
        <g mask="url(#mask0_114_46407)">
          <path opacity="0.4"
            d="M466.206 1249.13C488.246 1228.13 509.674 1206.75 530.489 1185.38C669.464 1042.13 770.174 901.5 837.519 771.375C896.598 657 929.046 551.25 940.066 457.5C949.862 375 942.821 301.125 922.924 237.75C905.169 181.125 876.395 131.625 839.662 90.375C806.296 52.875 765.277 21.375 718.442 -3.74999C634.873 -48.375 529.265 -74.625 402.229 -80.625C390.903 -68.625 379.27 -55.875 367.026 -43.125C467.737 -32.625 546.101 -4.87499 601.813 37.125C665.79 85.125 701.605 153.75 702.83 238.125C703.442 285.75 693.034 339 669.77 395.625C644.363 457.5 604.262 523.875 547.632 591.75C486.409 665.25 406.82 739.875 308.865 811.125C204.481 886.875 82.3426 957 -54.4891 1015.5C-55.7136 1086.75 -57.2441 1164.38 -58.7747 1249.13H466.206Z"
            fill="url(#paint0_radial_114_46407)" />
        </g>
        <mask id="mask1_114_46407" style="mask-type:luminance" maskUnits="userSpaceOnUse" x="-30" y="0" width="1102"
          height="1080">
          <path d="M1072 0H-30V1080H1072V0Z" fill="white" />
        </mask>
        <g mask="url(#mask1_114_46407)">
          <path
            d="M732.829 222C733.441 226.875 733.747 232.125 734.053 237.375C737.42 290.625 727.625 349.5 703.442 412.875C676.81 482.25 633.036 556.5 570.896 632.25C498.042 721.125 402.841 808.5 288.049 890.25C164.992 977.25 23.8752 1054.5 -128.262 1115.62C-128.262 1113.75 -128.262 1112.25 -127.956 1110.37C19.8958 1051.12 156.421 976.5 275.499 893.25C387.229 815.25 480.287 731.625 552.835 647.25C619.262 570 667.015 493.875 696.402 421.5C723.033 355.875 734.359 294 730.992 237.375C725.176 138 674.668 65.6247 597.528 18.7497C530.795 -21.7503 441.105 -45.0002 335.19 -50.6252C335.496 -51.0002 336.109 -51.3752 336.415 -51.7502C445.39 -45.7502 539.06 -21.3752 607.629 22.8747C677.729 68.2497 723.339 135 732.829 222Z"
            fill="#169F59" />
          <path
            d="M796.195 76.5C835.071 117 865.07 166.5 883.13 226.5C903.946 295.875 907.619 374.25 892.008 460.5C873.947 559.125 830.785 667.125 760.074 781.5C679.566 911.25 565.081 1046.62 416.923 1179C390.291 1202.62 362.741 1226.25 334.579 1249.5H344.681C375.904 1223.62 405.903 1197.75 434.984 1171.5C586.509 1033.88 702.219 892.875 780.889 756.75C842.418 650.25 879.763 550.5 895.987 460.125C910.374 379.875 907.925 307.5 891.395 243.375C889.865 237.75 888.334 231.75 886.497 226.125C853.744 118.125 779.971 40.5 682.015 -8.625C593.243 -52.875 480.594 -75 355.089 -76.875C354.783 -76.5 354.476 -76.125 354.17 -76.125C476.309 -74.25 584.06 -53.25 670.077 -12.375C718.443 10.5 760.992 39.75 796.195 76.5Z"
            fill="#169F59" />
          <path
            d="M811.194 232.5C812.112 237.75 813.03 243 813.643 248.25C812.418 248.25 811.194 248.625 809.969 248.625C808.745 240.75 807.52 232.5 805.99 225C807.214 225 808.439 224.625 809.357 224.625C810.275 226.875 810.888 229.5 811.194 232.5ZM804.153 201.375C802.929 201.375 802.01 201.75 800.786 201.75C798.643 194.625 796.5 187.5 794.052 180.375C795.276 180.375 796.194 180 797.419 180C799.868 187.125 802.01 194.25 804.153 201.375ZM816.398 273C817.01 281.625 817.316 290.625 817.316 299.25C816.092 299.25 814.867 299.25 813.643 299.25C813.643 290.25 813.337 281.625 812.724 273C813.949 273.375 815.173 273 816.398 273ZM789.154 159.75C788.235 160.125 787.011 160.125 786.093 160.5C783.338 154.125 780.276 147.75 776.909 141.375C777.828 141 779.052 141 779.97 140.625C783.031 147 786.399 153.375 789.154 159.75ZM816.704 327.375C816.092 336.75 815.173 346.875 813.949 356.625C812.724 356.625 811.5 356.625 809.969 356.625C811.194 346.875 812.112 337.125 812.724 327.75C813.949 327.375 815.173 327.375 816.704 327.375ZM769.563 122.625C768.644 123 767.726 123 766.502 123.375C762.828 117.75 759.155 111.75 755.175 106.5C756.094 106.125 757.012 106.125 757.93 105.75C762.216 111 765.889 117 769.563 122.625ZM809.051 387C807.214 397.5 804.765 408 802.01 418.875C800.786 418.875 799.255 418.5 798.031 418.5C800.786 408 802.929 397.125 805.072 386.625C806.602 386.625 807.827 387 809.051 387ZM745.992 89.6245C745.074 89.9995 744.155 89.9995 743.237 90.3745C738.951 85.1245 734.666 80.2495 730.38 75.3745C731.299 74.9995 732.217 74.9995 733.135 74.6245C737.421 79.4995 742.013 84.3745 745.992 89.6245ZM793.133 452.25C789.766 463.5 785.786 475.125 781.501 486.75C779.97 486.375 778.746 486.375 777.522 486C781.807 474.375 785.786 462.75 789.154 451.5C790.378 451.875 791.603 451.875 793.133 452.25ZM719.36 60.3745C718.442 60.7495 717.524 60.7495 716.911 61.1245C712.32 56.6245 707.422 52.1245 702.524 47.9995C703.443 47.6245 704.055 47.2495 704.973 47.2495C709.565 51.7495 714.463 56.2495 719.36 60.3745ZM766.808 522.75C761.604 535.125 755.788 547.5 749.665 560.25C748.135 559.875 746.91 559.5 745.38 559.125C751.502 546.75 757.318 534 762.522 522C764.053 522.375 765.583 522.375 766.808 522.75ZM689.361 35.2495C688.443 35.6245 687.831 35.9995 686.913 35.9995C681.709 32.2495 676.505 28.1245 670.995 24.7495C671.913 24.3745 672.525 23.9995 673.444 23.9995C678.954 27.3745 684.158 31.1245 689.361 35.2495ZM729.462 598.875C722.115 612 714.463 625.5 706.198 639C704.667 638.625 703.443 637.875 701.912 637.5C710.177 624.375 717.83 610.875 725.177 597.75C726.707 598.125 728.238 598.5 729.462 598.875ZM656.914 13.1245C656.301 13.4995 655.383 13.8745 654.771 13.8745C649.261 10.4995 643.445 7.12451 637.935 4.12451C638.547 3.74951 639.465 3.37452 640.078 3.37452C645.588 6.37452 651.404 9.74951 656.914 13.1245ZM679.872 680.25C670.383 694.125 660.281 708.375 649.873 722.625C648.649 721.875 647.118 721.125 645.894 720.75C656.302 706.875 666.403 692.625 675.893 678.75C677.117 679.125 678.341 679.5 679.872 680.25ZM622.323 -5.62549C621.711 -5.25049 620.793 -4.87548 620.18 -4.87548C614.364 -7.87548 608.242 -10.5005 602.12 -13.1255C602.732 -13.5005 603.344 -13.8755 603.956 -14.2505C610.385 -11.2505 616.507 -8.62549 622.323 -5.62549ZM616.507 765.375C604.875 780 592.324 794.625 579.468 809.25C578.243 808.5 577.019 807.375 575.488 806.625C588.345 792 600.589 777.375 612.528 763.125C613.752 763.875 614.977 764.625 616.507 765.375ZM585.59 -21.3755C584.978 -21.0005 584.365 -20.6255 583.753 -20.2505C577.631 -22.5005 571.203 -25.1255 564.774 -27.0005C565.386 -27.3755 565.999 -27.7505 566.611 -28.1255C573.039 -26.2505 579.468 -24.0005 585.59 -21.3755ZM538.755 853.875C524.674 868.875 509.674 883.875 494.369 898.875C493.144 897.75 491.92 896.625 490.695 895.5C505.695 880.875 520.694 865.875 534.775 850.875C536.306 852 537.53 853.125 538.755 853.875ZM547.326 -34.5005C546.714 -34.1255 546.101 -33.7505 545.489 -33.3755C539.061 -35.2505 532.326 -37.1255 525.898 -39.0005C526.51 -39.3755 527.123 -39.7505 527.429 -40.1255C534.163 -38.2505 540.898 -36.3755 547.326 -34.5005ZM446.615 943.875C430.085 958.875 412.637 974.25 395.189 988.875C394.27 987.75 393.046 986.25 392.128 985.125C409.576 970.5 427.024 955.125 443.554 940.5C444.166 941.625 445.391 942.75 446.615 943.875ZM507.531 -45.0005C506.919 -44.6255 506.613 -44.2505 506.001 -43.8755C499.266 -45.3755 492.532 -46.8755 485.798 -48.3755C486.41 -48.7505 486.716 -49.1255 487.328 -49.5005C494.063 -48.0005 500.797 -46.5005 507.531 -45.0005ZM339.783 1033.87C320.804 1048.87 301.213 1063.5 281.315 1078.12C280.397 1076.62 279.785 1075.12 278.866 1073.62C298.764 1059.37 318.049 1044.37 337.028 1029.75C337.946 1031.25 338.864 1032.75 339.783 1033.87ZM466.513 -53.2505C465.9 -52.8755 465.594 -52.5005 464.982 -52.1255C458.248 -53.2505 451.207 -54.3755 444.166 -55.5005C444.779 -55.8755 445.085 -56.2505 445.697 -56.6255C452.738 -55.1255 459.778 -54.3755 466.513 -53.2505ZM219.787 1122C198.665 1136.25 176.931 1150.5 155.197 1164.37C154.585 1162.5 153.973 1161 153.361 1159.12C175.095 1145.25 196.829 1131.37 217.644 1117.12C218.256 1118.62 219.175 1120.12 219.787 1122ZM424.575 -58.8755C424.269 -58.5005 423.657 -58.1255 423.351 -57.7505C416.31 -58.5005 409.27 -59.2505 402.229 -60.0005C402.535 -60.3755 403.148 -60.7505 403.454 -61.1255C410.494 -60.3755 417.535 -59.6255 424.575 -58.8755ZM87.853 1205.25C65.2008 1218.75 41.6302 1231.87 18.0597 1244.62C17.7536 1242.75 17.4475 1240.87 17.1414 1238.62C40.4058 1225.87 63.6703 1212.75 86.3225 1199.62C86.9347 1201.5 87.2408 1203.37 87.853 1205.25ZM381.72 -63.0005C381.414 -62.6255 380.801 -62.2505 380.495 -61.8755C379.577 -61.8755 378.965 -61.8755 378.046 -61.8755C378.353 -62.2505 378.965 -62.6255 379.271 -63.0005C380.189 -63.0005 381.108 -63.0005 381.72 -63.0005Z"
            fill="url(#paint1_radial_114_46407)" />
        </g>
      </g>
      <defs>
        <radialGradient id="paint0_radial_114_46407" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
          gradientTransform="translate(198.166 383.84) scale(731.806 896.496)">
          <stop offset="0.393" stop-color="#404040" />
          <stop offset="0.5326" stop-color="#3B3B3B" />
          <stop offset="0.699" stop-color="#2C2C2C" />
          <stop offset="0.8785" stop-color="#151515" />
          <stop offset="1" />
        </radialGradient>
        <radialGradient id="paint1_radial_114_46407" cx="0" cy="0" r="1" gradientUnits="userSpaceOnUse"
          gradientTransform="translate(257.171 1232.11) scale(1124.57 1377.64)">
          <stop offset="0.393" stop-color="white" />
          <stop offset="0.4788" stop-color="#FAFAFA" />
          <stop offset="0.5811" stop-color="#EBEBEB" />
          <stop offset="0.6915" stop-color="#D4D4D4" />
          <stop offset="0.7313" stop-color="#C9C9C9" />
          <stop offset="1" stop-color="#636363" />
        </radialGradient>
      </defs>
    </svg>
    <div class="login-box">
      <LoginBox :title="__('Log in')" :class="{ 'pointer-events-none': loading }">
        <form class="flex flex-col" @submit.prevent="">
          <Input v-model="email" class="mb-2" label="Email" name="email" autocomplete="email"
            :type="email !== 'Administrator' ? 'email' : 'text'" />
          <Input v-model="password" :label="__('Password')" type="password" name="password"
            autocomplete="current-password" />
          <ErrorMessage :message="errorMessage" class="mt-4" />
          <Button class="mt-4 focus:ring-0 focus:ring-offset-0" :loading="loading" variant="solid" @click="login">
            {{ __('Submit') }}
          </Button>
          <div class="mt-10 text-center border-t">
            <div class="transform -translate-y-1/2">
              <span class="px-2 text-xs leading-8 tracking-wider text-gray-800 bg-white">
                {{ __('OR') }}
              </span>
            </div>
          </div>
          <Button v-for="provider in $resources.authProviders.data" :key="provider.name"
            class="mb-4 focus:ring-0 focus:ring-offset-0" variant="solid" @click="redirect(provider.auth_url)">
            <template v-if="provider.name == 'frappe'" #prefix>
              <svg class="h-4.5" style="fill: white" width="24" height="24" viewBox="0 0 24 24"
                xmlns="http://www.w3.org/2000/svg">
                <path d="M5 3.68891V5.37783H11.5H18V3.68891V2H11.5H5V3.68891Z" />
                <path
                  d="M5 15.9374V21.2443H7.07628H9.15256V17.6341V14.0238H13.1502H17.1478V12.3272V10.6305H11.0739H5V15.9374Z" />
              </svg>
            </template>
            {{ __('Login via') }} {{ provider.provider_name }}
          </Button>
          <div class="flex justify-center items-center">
            <span>{{ __("Don't have an account?") }}</span>
            <span>&nbsp;&nbsp;</span>
            <router-link class="text-base text-blue-500" to="/signup">
              {{ __('SIGN UP') }}
            </router-link>
          </div>
        </form>
      </LoginBox>
    </div>

  </div>
</template>
<script>
import { Input, ErrorMessage } from "frappe-ui"
import LoginBox from "@/components/LoginBox.vue"

export default {
  name: "Login",
  components: {
    LoginBox,
    Input,
    ErrorMessage,
  },
  data() {
    return {
      loading: false,
      email: null,
      password: null,
      errorMessage: null,
      successMessage: null,
      redirect_route: null,
    }
  },
  methods: {
    redirect(link) {
      window.location.href = link
    },
    async login() {
      try {
        this.errorMessage = null
        this.loading = true
        if (this.email && this.password) {
          let res = await this.$store.dispatch("login", {
            email: this.email,
            password: this.password,
          })
          if (res) {
            this.$router.push("/home")
          }
        }
      } catch (error) {
        if (error.messages.includes("User disabled or missing")) {
          this.errorMessage = "Account not activated"
        } else {
          this.errorMessage = error.messages.join("\n")
        }
      } finally {
        this.loading = false
      }
    },
  },
  resources: {
    authProviders() {
      return {
        url: "drive.api.api.oauth_providers",
        onError(error) {
          if (error.messages) {
            console.log(error.messages)
          }
        },
        auto: true,
      }
    },
  },
}
</script>

<style scoped>
html {
  -webkit-user-select: none;
  /* Safari */
  -ms-user-select: none;
  /* IE 10 and IE 11 */
  user-select: none;
  /* Standard syntax */
}

.bg-login {
  background: linear-gradient(135deg, #118D57 0%, #1AAC5B 61.5%, #1DB45C 87.5%, #22C55E 100%);
}

.bg-login svg {
  position: relative;
  /* Vị trí của SVG */
  z-index: 1;
  /* SVG sẽ nằm bên dưới */
}

.login-box {
  position: absolute;
  top: 40%;
  left: 50%;
  transform: translate(-40%, -50%);
  z-index: 2;
}
</style>
